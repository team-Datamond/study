# 7. 조건 분기, 집합 연산, 윈도우 함수, 갱신
### 7-1. SQL과 조건 분기
- SQL 프로그래밍 중급 이상으로 올라가려면 반드시 이해해야 하는 것이 바로 CASE 식이다
- CASE 식의 구문에는 단순 CASE 식과 검색 CASE 식이 있는데, 검색 CASE 식이 단순 CASE 식의 기능을 모두 포함하고 있으므로 검색 CASE 식만 기억해도 충분하다
- CASE 식은 처음에 있는 WHEN 구의 평가식부터 평가되고 조건이 맞으면 THEN 구에서 지정한 식이 리턴되며 CASE 식 전체가 종료된다

```sql
SELECT name, address,
  CASE WHEN address = '서울시' THEN '경기'
       ELSE NULL END AS district
FROM Address;
```
- CASE 식은 SELECT< WHERE, GROUP BY, HAVING, ORDER BY 구와 같은 곳 어디에나 적을 수 있으므로 다양한 기법으로 활용할 수 있다

### 7-2. SQL의 집합 연산
- UNION은 합집합을 구할 때 중복된 레코드를 제거한다
- 중복을 제외하고 싶지 않다면 UNION ALL을 사용한다
- INTERSECT, EXCEPT로 각각 교집합과 차집합을 구한다

### 7-3. 윈도우 함수
- 윈도우 함수의 특징을 한마디로 정리하면 '집약 기능이 없는 GROUP BY 구'이다
- 윈도우 함수는 PARTITION BY라는 구로 수행한다

```sql
SELECT address,
  COUNT(*) OVER(PARTITION BY address)
FROM Address
```

- RANK 함수로 레코드에 순위를 붙일 수 있다

### 7-4. 트랜잭션과 갱신
- INSERT, DELETE, UPDATE로 각각 삽입, 삭제, 갱신을 할 수 있다

<hr>

# 8. UNION을 사용한 쓸데없이 긴 표현
- UNION을 사용한 조건 분기는 SQL 초보자가 좋아하는 기술 중 하나이다

### 8-1. UNION을 사용한 조건 분기와 관련된 간단한 예제
- 정확한 판단 없이 SELECT 구문 전체를 여러 번 사용해서 코드를 길게 만드는 것은 쓸데없는 테이블 접근을 발생시키며 SQL의 성능을 나쁘게 만들고, 또 물리자원도 쓸데없이 소비하게 된다

### 8-2. WHERE 구에서 조건 분기를 하는 사람은 초보자
- 조건 분기를 WHERE 구로 하는 사람들을 초보자다, 잘하는 사람은 SELECT 구만으로 조건 분기를 한다

### 8-3. SELECT 구를 사용한 조건 분기의 실행 계획
- UNION을 사용한 분기는 SELECT '구문'을 기본 단위로 분기하고 있다
- 구문을 기본 단위로 사용하고 있다는 점에서, 아직 절차 지향형의 발상을 벗어나지 못한 방법이라고 말할 수 있다
- 반면 CASE 식을 사용한 분기는 문자 그대로 '식'을 바탕으로 하는 사고이다
- 이렇게 '구문'에서 '식'으로 사고를 변경하는 것이 SQL을 마스터하는 열쇠 중 하나이다

<hr>

